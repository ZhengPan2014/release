"use strict";var _createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var NAV_CTRL_STATUS={ERROR:-1,IDLING:0,RUNNING:1,PAUSED:2,COMPLETED:3,CANCELLED:4,SUB_CANCELLED:5},WaypointsUtils=function(){function a(b){var d=this,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";_classCallCheck(this,a),this.ros=b,this.namespace=c,this.waypoints=[],this.trajectories=[],this.waitWaypoint=null,this.homeWaypoint=null,this.pendingTask=null,this.AGVStatus={waypoint_name:"",status:NAV_CTRL_STATUS.IDLING},this.waypointsTopic=this._topic("/waypoints","yocs_msgs/WaypointList"),this.waypointsTopic.subscribe(function(e){d.waypoints=e.waypoints,d.waitWaypoint=d._getWaypointByName("wait"),d.homeWaypoint=d._getWaypointByName("home")}),this.trajectoriesTopic=this._topic("/trajectories","yocs_msgs/TrajectoryList"),this.trajectoriesTopic.subscribe(function(e){d.trajectories=e.trajectories,d.pendingTask&&d._getTrajectoryByName(d.pendingTask.goal_name)&&(d.navCtrlTopic.publish(d.pendingTask),d.pendingTask=null)}),this.trajAddTopic=this._topic("/trajectory_add","yocs_msgs/Trajectory"),this.navCtrlTopic=this._topic("/nav_ctrl","yocs_msgs/NavigationControl"),this.navCtrlStatusTopic=this._topic("/nav_ctrl_status","yocs_msgs/NavigationControlStatus"),this.navCtrlStatusTopic.subscribe(function(e){d.AGVStatus=e}),this.waypointUserPubTopic=this._topic("/waypoint_user_pub","std_msgs/String"),setInterval(function(){var e=new ROSLIB.Message({data:"power"});d.waypointUserPubTopic.publish(e)},1e3)}return _createClass(a,[{key:"hasWaypoint",value:function hasWaypoint(b){for(var c=0;c<this.waypoints.length;c++)if(b===this.waypoints[c].name)return!0;return!1}},{key:"execute",value:function execute(b){for(var f,d=[],e=0;e<b.length;e++){if(f=this._getWaypointByName(b[e]),!f)return!1;d.push(f),d.push(this.waitWaypoint)}d.push(this.homeWaypoint);var g=new ROSLIB.Message({name:c,waypoints:d});return this.trajAddTopic.publish(g),this.pendingTask=this._navCtrlMsg(c,1),!0}},{key:"executeOne",value:function executeOne(b){return this.hasWaypoint(b)?this.AGVStatus.status===NAV_CTRL_STATUS.IDLING?(console.log("Published CMD: "+b),this.navCtrlTopic.publish(this._navCtrlMsg(b,1)),!0):(console.warn("AGV status: "+this.AGVStatus+" when try to go to "+b),!1):(console.warn(b+" not found"),!1)}},{key:"cancel",value:function cancel(){console.log("Published CMD: CANCEL"),this.navCtrlTopic.publish(this._navCtrlMsg("",0))}},{key:"goHome",value:function goHome(){console.log("Published CMD: "+this.homeWaypoint.name);var b=this._navCtrlMsg(this.homeWaypoint.name,1);this.navCtrlTopic.publish(b)}},{key:"_getWaypointByName",value:function _getWaypointByName(b){for(var d,c=0;c<this.waypoints.length;c++)if(d=this.waypoints[c],d.name===b)return d}},{key:"_getTrajectoryByName",value:function _getTrajectoryByName(b){for(var d,c=0;c<this.trajectories.length;c++)if(d=this.trajectories[c],d.name===b)return d}},{key:"_navCtrlMsg",value:function _navCtrlMsg(b,c){return new ROSLIB.Message({goal_name:b,control:c})}},{key:"_topic",value:function _topic(b,c){return new ROSLIB.Topic({ros:this.ros,name:this._withNs(b),messageType:c})}},{key:"_withNs",value:function _withNs(b){var c=b.startsWith("/")?b:"/"+b;return""===this.namespace||"/"===this.namespace?c:this.namespace.startsWith("/")?this.namespace+c:"/"+this.namespace+c}}]),a}();